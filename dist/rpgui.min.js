RPGUI=function(){var h=h||{};h.version=1.03,h.author="Ronen Ness",h.init_on_load=!0,window.addEventListener("load",function(){h.init_on_load&&h.init()}),h.init=function(){if(h._was_init)throw"RPGUI was already init!";for(var e=0;e<h.__init_list.length;++e)h.__init_list[e]();h._was_init=!0},h.__init_list=[],h.on_load=function(e){h._was_init&&e(),h.__init_list.push(e)},h.__update_funcs={},h.__create_funcs={},h.__get_funcs={},h.__set_funcs={},h.create=function(e,n){if(!h.__create_funcs[n])throw"Not a valid rpgui type! options: "+Object.keys(h.__create_funcs);e.dataset.rpguitype=n,h.__create_funcs[n](e)},h.update=function(e){var n=e.dataset.rpguitype;h.__update_funcs[n]?h.__update_funcs[n](e):h.fire_event(e,"change")},h.set_value=function(e,n){var t=e.dataset.rpguitype;h.__set_funcs[t]?h.__set_funcs[t](e,n):e.value=n,h.update(e)},h.get_value=function(e){var n=e.dataset.rpguitype;return h.__get_funcs[n]?h.__get_funcs[n](e):e.value};var s="rpgui-checkbox";h.__create_funcs.checkbox=function(e){h.add_class(e,s),function(e){var n,t=e.nextSibling;if(!t||"LABEL"!==t.tagName)throw"After a '"+s+"' there must be a label!";h.copy_event_listeners(e,t),n=e,t.addEventListener("click",function(){n.disabled||h.set_value(n,!n.checked)})}(e)},h.__set_funcs.checkbox=function(e,n){e.checked=n},h.__get_funcs.checkbox=function(e){return e.checked},h.on_load(function(){for(var e=document.getElementsByClassName(s),n=0;n<e.length;++n)h.create(e[n],"checkbox")}),h.on_load(function(){for(var e=document.getElementsByClassName("rpgui-content"),n=0;n<e.length;++n){var t=e[n];h.prevent_drag(t),h.set_cursor(t,"default")}});var a=null,i=null,r=1e3,o="rpgui-draggable";function t(e){a=null,window.removeEventListener("mousemove",c),window.removeEventListener("touchmove",l)}function n(e){var n,t=e.target||e.srcElement;h.has_class(t,o)&&(n=(a=t).getBoundingClientRect(),i={x:n.left-e.clientX,y:n.top-e.clientY},t.style.zIndex=r++,window.addEventListener("mousemove",c,!0))}function d(e){var n,t=e.target||e.srcElement;h.has_class(t,o)&&(n=(a=t).getBoundingClientRect(),i={x:n.left-e.changedTouches[0].pageX,y:n.top-e.changedTouches[0].pageY},t.style.zIndex=r++,window.addEventListener("touchmove",l,!0))}function c(e){a&&(a.style.position="fixed",a.style.left=e.clientX+i.x+"px",a.style.top=e.clientY+i.y+"px")}function l(e){0<e.changedTouches.length&&(a.style.position="fixed",a.style.left=e.changedTouches[0].pageX+i.x+"px",a.style.top=e.changedTouches[0].pageY+i.y+"px")}h.__create_funcs.draggable=function(e){e.draggable=!1,e.ondragstart=function(){return!1},h.add_class(e,o),e.addEventListener("mousedown",n),e.addEventListener("touchstart",d)},h.on_load(function(){for(var e=document.getElementsByClassName(o),n=0;n<e.length;++n)h.create(e[n],"draggable");window.addEventListener("mouseup",t),window.addEventListener("touchend",t),window.addEventListener("touchcancel",t)}),h.__create_funcs.progress=function(e){h.add_class(e,"rpgui-progress"),function(e){progress_container=e,h.insert_after(progress_container,e);var n=h.create_element("div");h.add_class(n,"rpgui-progress-track"),progress_container.appendChild(n);var t=h.create_element("div");h.add_class(t,"rpgui-progress-left-edge"),progress_container.appendChild(t),t=h.create_element("div"),h.add_class(t,"rpgui-progress-right-edge"),progress_container.appendChild(t),t=h.create_element("div"),h.add_class(t,"rpgui-progress-fill"),n.appendChild(t),h.has_class(e,"blue")&&(t.className+=" blue"),h.has_class(e,"red")&&(t.className+=" red"),h.has_class(e,"green")&&(t.className+=" green"),t=void 0!==e.dataset.value?parseFloat(e.dataset.value):1,h.set_value(e,t)}(e)},h.__set_funcs.progress=function(e,n){var t=h.get_child_with_class(e,"rpgui-progress-track"),t=h.get_child_with_class(t,"rpgui-progress-fill");h.get_child_with_class(e,"rpgui-progress-left-edge"),h.get_child_with_class(e,"rpgui-progress-right-edge"),t.style.left="0px",t.style.width=100*n+"%"},h.on_load(function(){for(var e=document.getElementsByClassName("rpgui-progress"),n=0;n<e.length;++n)h.create(e[n],"progress")});var u="rpgui-radio";return h.__create_funcs.radio=function(e){h.add_class(e,u),function(e){var n,t=e.nextSibling;if(!t||"LABEL"!==t.tagName)throw"After a '"+u+"' there must be a label!";h.copy_event_listeners(e,t),n=e,t.addEventListener("click",function(){n.disabled||h.set_value(n,!0)})}(e)},h.__set_funcs.radio=function(e,n){e.checked=n},h.__get_funcs.radio=function(e){return e.checked},h.on_load(function(){for(var e=document.getElementsByClassName(u),n=0;n<e.length;++n)h.create(e[n],"radio")}),h.__create_funcs.dropdown=function(e){h.add_class(e,"rpgui-dropdown"),function(e){var n=h.create_element("p");e.id&&(n.id=e.id+"-rpgui-dropdown-head"),h.add_class(n,"rpgui-dropdown-imp rpgui-dropdown-imp-header"),h.insert_after(n,e);var t=h.create_element("ul");e.id&&(t.id=e.id+"-rpgui-dropdown"),h.add_class(t,"rpgui-dropdown-imp"),h.insert_after(t,n);var s=n.getBoundingClientRect();t.style.position="absolute",t.style.width=s.right-s.left-14+"px",t.style.display="none",e.style.display="none";for(var a,i,r,o,d,c=0;c<e.children.length;++c){var l,u=e.children[c];"OPTION"==u.tagName&&((l=h.create_element("li")).innerHTML=u.innerHTML,t.appendChild(l),h.copy_event_listeners(u,l),function(e,n,t,s){l.addEventListener("click",function(){t.innerHTML="<label>&#9660;</label> "+n.innerHTML,s.style.display="none",n.selected=!0,h.fire_event(e,"change")})}(e,u,n,t))}o=e,d=t,n.onclick=function(){var e;o.disabled||(e=d.style.display,d.style.display="none"==e?"block":"none")},d.onmouseleave=function(){d.style.display="none"},i=n,r=t,_on_change=function(){-1!=a.selectedIndex?i.innerHTML="<label>&#9660;</label> "+a.options[a.selectedIndex].text:i.innerHTML="<label>&#9660;</label> ",r.style.display="none"},(a=e).addEventListener("change",_on_change),_on_change()}(e)},h.on_load(function(){for(var e=document.getElementsByClassName("rpgui-dropdown"),n=0;n<e.length;++n)h.create(e[n],"dropdown")}),h.__create_funcs.list=function(e){h.add_class(e,"rpgui-list"),function(e){e.size||(e.size=3);var n=h.create_element("ul");e.id&&(n.id=e.id+"-rpgui-list"),h.add_class(n,"rpgui-list-imp"),e.parentNode.insertBefore(n,e.nextSibling),e.style.display="none";for(var t,s,a=[],i=0;i<e.children.length;++i){var r,o=e.children[i];"OPTION"==o.tagName&&((r=h.create_element("li")).innerHTML=o.innerHTML,n.appendChild(r),r.dataset.rpguivalue=o.value,a.push(r),h.copy_event_listeners(o,r),function(e,n){r.addEventListener("click",function(){e.disabled||(n.selected=!0,h.fire_event(e,"change"))})}(e,o))}function d(e){for(var n=0;n<s.length;++n){var t=s[n];t.dataset.rpguivalue==e.value?h.add_class(t,"rpgui-selected"):h.remove_class(t,"rpgui-selected")}}a.length&&e.size&&(t=a[0].offsetHeight,n.style.height=t*e.size+"px"),s=a,(t=e).addEventListener("change",function(){d(this)}),d(t)}(e)},h.on_load(function(){for(var e=document.getElementsByClassName("rpgui-list"),n=0;n<e.length;++n)h.create(e[n],"list")}),h.__create_funcs.slider=function(e){h.add_class(e,"rpgui-slider"),function(e){var n=h.has_class(e,"golden")?" golden":"",t=h.create_element("div");e.id&&(t.id=e.id+"-rpgui-slider"),h.copy_css(e,t),h.add_class(t,"rpgui-slider-container"+n),h.insert_after(t,e),t.style.width=e.offsetWidth+"px";var s=h.create_element("div");h.add_class(s,"rpgui-slider-track"+n),t.appendChild(s);var a=h.create_element("div");h.add_class(a,"rpgui-slider-left-edge"+n),t.appendChild(a);var i=h.create_element("div");h.add_class(i,"rpgui-slider-right-edge"+n),t.appendChild(i);var r,o,d,c,l,u,_,f=h.create_element("div");function p(e){g(c+Math.round(e/_*(l-c))-1)}function g(e){r.disabled||r.value==e||h.set_value(r,e)}function v(){var e=_/(l-c),n=Math.round(parseFloat(r.value)-c);o.style.left=Math.floor(.25*u)+n*e+"px"}h.add_class(f,"rpgui-slider-thumb"+n),t.appendChild(f),e.style.display="none",h.copy_event_listeners(e,t),r=e,t=t,o=f,s=s,d={mouse_down:!1},i=i,a=a,c=parseFloat(r.min),l=parseFloat(r.max),u=i.offsetWidth+a.offsetWidth,_=s.offsetWidth-u,t.addEventListener("mouseup",function(e){d.mouse_down=!1}),window.addEventListener("mouseup",function(e){d.mouse_down=!1}),s.addEventListener("mousedown",function(e){d.mouse_down=!0,p(e.offsetX||e.layerX)}),t.addEventListener("mousedown",function(e){d.mouse_down=!0}),a.addEventListener("mousedown",function(e){g(c)}),i.addEventListener("mousedown",function(e){g(l)}),a.addEventListener("mousemove",function(e){d.mouse_down&&g(c)}),i.addEventListener("mousemove",function(e){d.mouse_down&&g(l)}),s.addEventListener("mousemove",function(e){d.mouse_down&&!r.disabled&&p(e.offsetX||e.layerX)}),r.addEventListener("change",function(e){v()}),v()}(e)},h.on_load(function(){for(var e=document.getElementsByClassName("rpgui-slider"),n=0;n<e.length;++n)h.create(e[n],"slider")}),h.create_element=function(e){return document.createElement(e)},h.set_cursor=function(e,n){h.add_class(e,"rpgui-cursor-"+n)},h.prevent_drag=function(e){},h.copy_css=function(e,n){n.style.cssText=e.style.cssText},h.has_class=function(e,n){return-1<(" "+e.className+" ").indexOf(" "+n+" ")},h.add_class=function(e,n){h.has_class(e,n)||(e.className+=" "+n)},h.get_child_with_class=function(e,n){for(var t=0;t<e.childNodes.length;t++)if(h.has_class(e.childNodes[t],n))return e.childNodes[t]},h.remove_class=function(e,n){e.className=(" "+e.className+" ").replace(n,""),e.className=e.className.substring(1,e.className.length-1)},h.fire_event=function(e,n){var t;"createEvent"in document?((t=document.createEvent("HTMLEvents")).initEvent(n,!1,!0),e.dispatchEvent(t)):e.fireEvent("on"+n)},h.copy_event_listeners=function(e,n){if("function"==typeof getEventListeners){var t,s=getEventListeners(e);for(t in s)s[t].forEach(function(e){n.addEventListener(t,e.listener,e.useCapture)})}for(attr in e)0===attr.indexOf("on")&&(n[attr]=e[attr])},h.insert_after=function(e,n){n.parentNode.insertBefore(e,n.nextSibling)},h}();
